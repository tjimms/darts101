<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DARTS101 - Darts Scoreboard</title>
  <link rel="icon" type="image/png" href="darts_101_favicon.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            dart: {
              navy: '#111A2C',
              'navy-light': '#243352',
              bordeaux: '#780226',
              'blue-hover': '#A10232',
              success: '#22c55e',
              warning: '#f59e0b',
            }
          }
        }
      }
    }
  </script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 0 0 rgba(14, 165, 233, 0.4); }
      50% { box-shadow: 0 0 20px 5px rgba(14, 165, 233, 0.2); }
    }
  </style>
</head>

<body class="min-h-screen bg-dart-navy text-white">
  <div class="py-8 px-4">
    <!-- Header -->
    <div class="text-center mb-8">
      <img
        src="darts_101_logo.png"
        alt="Darts 101 Logo"
        class="mx-auto h-24 md:h-32"
      />
    </div>

    <!-- Setup Screen -->
    <div id="setup-screen" class="w-full max-w-md mx-auto">
      <div class="bg-white rounded-2xl shadow-2xl p-6 space-y-6">
        <!-- Game Type -->
        <div class="space-y-2">
          <label class="text-gray-500 text-sm">Game type</label>
          <div id="game-type-buttons" class="flex bg-gray-100 rounded-full p-1">
            <button data-type="101" class="game-type-btn flex-1 py-2 px-3 rounded-full text-sm font-medium transition-all text-gray-700 hover:bg-gray-200">101</button>
            <button data-type="201" class="game-type-btn flex-1 py-2 px-3 rounded-full text-sm font-medium transition-all bg-dart-bordeaux text-white shadow-md">201</button>
            <button data-type="301" class="game-type-btn flex-1 py-2 px-3 rounded-full text-sm font-medium transition-all text-gray-700 hover:bg-gray-200">301</button>
            <button data-type="401" class="game-type-btn flex-1 py-2 px-3 rounded-full text-sm font-medium transition-all text-gray-700 hover:bg-gray-200">401</button>
            <button data-type="501" class="game-type-btn flex-1 py-2 px-3 rounded-full text-sm font-medium transition-all text-gray-700 hover:bg-gray-200">501</button>
          </div>
        </div>

        <!-- Sets and Legs -->
        <div class="grid grid-cols-2 gap-4">
          <div class="space-y-2">
            <label class="text-gray-500 text-sm">Sets</label>
            <select id="sets-select" class="w-full p-3 border border-gray-200 rounded-lg text-gray-700 bg-white">
              <option value="1">1 set</option>
              <option value="3" selected>3 sets</option>
              <option value="5">5 sets</option>
              <option value="7">7 sets</option>
            </select>
          </div>
          <div class="space-y-2">
            <label class="text-gray-500 text-sm">Legs</label>
            <select id="legs-select" class="w-full p-3 border border-gray-200 rounded-lg text-gray-700 bg-white">
              <option value="1">1 leg</option>
              <option value="3">3 legs</option>
              <option value="5" selected>5 legs</option>
              <option value="7">7 legs</option>
            </select>
          </div>
        </div>

        <!-- Players -->
        <div class="space-y-3">
          <label id="player-count-label" class="text-gray-500 text-sm">2 Players</label>
          <div id="players-container" class="space-y-3">
            <div class="flex items-center gap-2">
              <div class="relative flex-1">
                <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <input type="text" class="player-input w-full pl-10 pr-4 py-3 bg-gray-100 border-0 rounded-lg text-gray-700" placeholder="Player 1 name (starts)" value="Player 1" />
              </div>
            </div>
            <div class="flex items-center gap-2">
              <div class="relative flex-1">
                <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <input type="text" class="player-input w-full pl-10 pr-4 py-3 bg-gray-100 border-0 rounded-lg text-gray-700" placeholder="Player 2 name" value="Player 2" />
              </div>
              <button class="remove-player-btn hidden h-10 w-10 text-red-500 hover:bg-red-50 rounded-lg">
                <svg class="h-4 w-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                </svg>
              </button>
            </div>
          </div>

          <button id="add-player-btn" class="flex items-center gap-2 text-dart-bordeaux hover:text-dart-bordeaux-hover font-medium text-sm transition-colors">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Add new player
          </button>
        </div>

        <!-- Start Button -->
        <button id="start-game-btn" class="w-full h-14 text-lg font-semibold bg-dart-bordeaux hover:bg-dart-bordeaux-hover text-white rounded-xl shadow-lg transition-all hover:shadow-xl">
          POTJE?
        </button>
        <p class="text-center text-dart-bordeaux text-sm italic mt-0">Oké, even snel dan</p>
      </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="hidden w-full max-w-4xl mx-auto space-y-6">
      <!-- Game Header -->
      <div class="flex items-center justify-between">
        <button id="back-btn" class="flex items-center text-white hover:bg-dart-navy-light px-3 py-2 rounded-lg transition-colors">
          <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          Back
        </button>
        <div class="text-center">
          <span id="game-info" class="text-gray-400 text-sm"></span>
        </div>
        <button id="reset-btn" class="flex items-center text-white hover:bg-dart-navy-light px-3 py-2 rounded-lg transition-colors">
          <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          Reset
        </button>
      </div>

      <!-- Score Cards -->
      <div id="score-cards" class="grid grid-cols-2 gap-4 md:gap-6"></div>

      <!-- NEW: Checkout panel (white text on dark blue) -->
      <div id="checkout-panel" class="hidden rounded-2xl shadow-xl p-4 md:p-5 bg-dart-navy-light text-white">
        <div class="flex items-center justify-between gap-3">
          <p class="text-sm font-semibold tracking-wide">Possible throw outs</p>
          <p class="text-xs text-white/70">Double-out only</p>
        </div>
        <div id="checkout-options" class="mt-3 space-y-3"></div>
      </div>

      <!-- Score Input -->
      <div class="bg-white rounded-2xl shadow-xl p-6 space-y-4">
        <div class="text-center">
          <p id="current-turn" class="text-gray-500 text-sm mb-2"></p>
          <div class="bg-gray-100 rounded-xl p-4 min-h-[60px] flex items-center justify-center">
            <span id="score-display" class="text-4xl font-bold text-gray-800">0</span>
          </div>
        </div>

        <!-- Number Pad -->
        <div class="grid grid-cols-3 gap-2 lg:hidden">
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="1">1</button>
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="2">2</button>
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="3">3</button>
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="4">4</button>
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="5">5</button>
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="6">6</button>
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="7">7</button>
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="8">8</button>
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="9">9</button>
          <button id="clear-btn" class="h-14 text-lg font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">C</button>
          <button class="num-btn h-14 text-xl font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors" data-num="0">0</button>
          <button id="backspace-btn" class="h-14 text-lg font-semibold bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">←</button>
        </div>

        <button id="submit-btn" class="w-full h-14 text-lg font-semibold bg-dart-bordeaux hover:bg-dart-bordeaux-hover text-white rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          SUBMIT SCORE
        </button>
      </div>
    </div>

    <!-- Winner Screen -->
    <div id="winner-screen" class="hidden w-full max-w-2xl mx-auto">
      <div class="bg-white rounded-2xl shadow-2xl p-8 text-center space-y-6">
        <svg class="h-20 w-20 text-amber-500 mx-auto" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
        </svg>
        <h1 id="winner-name" class="text-3xl font-bold text-gray-800"></h1>
        <p id="winner-score" class="text-gray-500"></p>
        <div class="flex gap-4 justify-center">
          <button id="play-again-btn" class="px-6 py-3 bg-dart-bordeaux hover:bg-dart-bordeaux-hover text-white rounded-lg font-semibold transition-colors">Play Again</button>
          <button id="new-setup-btn" class="px-6 py-3 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg font-semibold transition-colors">New Setup</button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300"></div>
  </div>

  <script>
    // Game State
    let gameType = 201;
    let sets = 3;
    let legs = 5;
    let players = [];
    let playerScores = [];
    let currentPlayerIndex = 0;
    let inputValue = '';

    // DOM Elements
    const setupScreen = document.getElementById('setup-screen');
    const gameScreen = document.getElementById('game-screen');
    const winnerScreen = document.getElementById('winner-screen');
    const scoreDisplay = document.getElementById('score-display');
    const submitBtn = document.getElementById('submit-btn');
    const toast = document.getElementById('toast');

    // NEW: checkout DOM
    const checkoutPanel = document.getElementById('checkout-panel');
    const checkoutOptions = document.getElementById('checkout-options');

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      setupGameTypeButtons();
      setupPlayerButtons();
      setupGameControls();
      setupNumberPad();
      setupKeyboardInput(); // keyboard numbers + enter/backspace/esc
    });

    // Game Type Selection
    function setupGameTypeButtons() {
      document.querySelectorAll('.game-type-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.game-type-btn').forEach(b => {
            b.classList.remove('bg-dart-bordeaux', 'text-white', 'shadow-md');
            b.classList.add('text-gray-700', 'hover:bg-gray-200');
          });
          btn.classList.add('bg-dart-bordeaux', 'text-white', 'shadow-md');
          btn.classList.remove('text-gray-700', 'hover:bg-gray-200');
          gameType = parseInt(btn.dataset.type);
        });
      });
    }

    // Player Management
    function setupPlayerButtons() {
      document.getElementById('add-player-btn').addEventListener('click', addPlayer);
      document.getElementById('start-game-btn').addEventListener('click', startGame);
    }

    function addPlayer() {
      const container = document.getElementById('players-container');
      const playerCount = container.children.length;
      if (playerCount >= 4) return;

      const div = document.createElement('div');
      div.className = 'flex items-center gap-2';
      div.innerHTML = `
        <div class="relative flex-1">
          <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
          <input type="text" class="player-input w-full pl-10 pr-4 py-3 bg-gray-100 border-0 rounded-lg text-gray-700" placeholder="Player ${playerCount + 1} name" value="Player ${playerCount + 1}">
        </div>
        <button class="remove-player-btn h-10 w-10 text-red-500 hover:bg-red-50 rounded-lg" onclick="removePlayer(this)">
          <svg class="h-4 w-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>
        </button>
      `;
      container.appendChild(div);
      updatePlayerCount();
      updateRemoveButtons();

      if (playerCount + 1 >= 4) {
        document.getElementById('add-player-btn').classList.add('hidden');
      }
    }

    function removePlayer(btn) {
      const container = document.getElementById('players-container');
      if (container.children.length <= 2) return;
      btn.parentElement.remove();
      updatePlayerCount();
      updateRemoveButtons();
      document.getElementById('add-player-btn').classList.remove('hidden');
    }

    function updatePlayerCount() {
      const count = document.querySelectorAll('.player-input').length;
      document.getElementById('player-count-label').textContent = `${count} Players`;
    }

    function updateRemoveButtons() {
      const container = document.getElementById('players-container');
      const buttons = container.querySelectorAll('.remove-player-btn');
      buttons.forEach(btn => {
        btn.classList.toggle('hidden', container.children.length <= 2);
      });
    }

    // Game Controls
    function setupGameControls() {
      document.getElementById('back-btn').addEventListener('click', showSetup);
      document.getElementById('reset-btn').addEventListener('click', resetGame);
      document.getElementById('play-again-btn').addEventListener('click', resetGame);
      document.getElementById('new-setup-btn').addEventListener('click', showSetup);
    }

    // Number Pad
    function setupNumberPad() {
      document.querySelectorAll('.num-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          if (inputValue.length < 3) {
            inputValue += btn.dataset.num;
            updateScoreDisplay();
          }
        });
      });

      document.getElementById('clear-btn').addEventListener('click', () => {
        inputValue = '';
        updateScoreDisplay();
      });

      document.getElementById('backspace-btn').addEventListener('click', () => {
        inputValue = inputValue.slice(0, -1);
        updateScoreDisplay();
      });

      document.getElementById('submit-btn').addEventListener('click', submitScore);
    }

    // Keyboard input support (digits, Enter, Backspace, Esc)
    function setupKeyboardInput() {
      document.addEventListener('keydown', (e) => {
        if (gameScreen.classList.contains('hidden')) return;

        const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';
        if (tag === 'input' || tag === 'textarea' || tag === 'select') return;

        if (e.key >= '0' && e.key <= '9') {
          if (inputValue.length < 3) {
            inputValue += e.key;
            updateScoreDisplay();
          }
          e.preventDefault();
          return;
        }

        if (e.key === 'Backspace') {
          inputValue = inputValue.slice(0, -1);
          updateScoreDisplay();
          e.preventDefault();
          return;
        }

        if (e.key === 'Escape') {
          inputValue = '';
          updateScoreDisplay();
          e.preventDefault();
          return;
        }

        if (e.key === 'Enter') {
          if (!submitBtn.disabled) submitScore();
          e.preventDefault();
          return;
        }
      });
    }

    function updateScoreDisplay() {
      scoreDisplay.textContent = inputValue || '0';
      submitBtn.disabled = !inputValue;
    }

    // ===== helpers for attempts + 3-dart average =====
    // history stores per-turn scores (each submit = one 3-dart turn)
    function getThreeDartAverage(player) {
      const turns = player.history.length;
      if (!turns) return 0;
      const total = player.history.reduce((a, b) => a + b, 0);
      return total / turns;
    }

    function formatAttempts(player, max = 8) {
      if (!player.history.length) return '—';
      const recent = player.history.slice(-max);
      const prefix = player.history.length > max ? '… ' : '';
      return prefix + recent.join(', ');
    }

    // ===== NEW: checkout helpers (DOUBLE-OUT ONLY) =====
    function scoreIsCheckoutCandidate(score) {
      // double-out: avoid 1, and show common checkout range (2..170)
      return score >= 2 && score <= 170 && score !== 1;
    }

    function getAllDarts() {
      // Darts usable on dart 1/2: S, D, T, and bulls (25/50)
      const darts = [];

      for (let n = 1; n <= 20; n++) darts.push({ label: `S${n}`, value: n });
      for (let n = 1; n <= 20; n++) darts.push({ label: `D${n}`, value: 2 * n });
      for (let n = 1; n <= 20; n++) darts.push({ label: `T${n}`, value: 3 * n });

      darts.push({ label: 'SBULL', value: 25 });
      darts.push({ label: 'BULL', value: 50 });

      return darts;
    }

    function getFinishingDarts() {
      // Final dart MUST be a double (bull=50 allowed)
      const finishes = [];
      for (let n = 1; n <= 20; n++) finishes.push({ label: `D${n}`, value: 2 * n });
      finishes.push({ label: 'BULL', value: 50 });
      return finishes;
    }

    function getCheckoutOptions(remaining, maxOptions = 3) {
      if (!scoreIsCheckoutCandidate(remaining)) return [];

      const darts = getAllDarts();
      const finishes = getFinishingDarts();
      const results = [];

      // 1 dart
      for (const f of finishes) {
        if (f.value === remaining) results.push([f]);
      }

      // 2 darts
      for (const a of darts) {
        const need = remaining - a.value;
        if (need <= 0) continue;
        for (const f of finishes) {
          if (f.value === need) results.push([a, f]);
        }
      }

      // 3 darts
      for (const a of darts) {
        for (const b of darts) {
          const need = remaining - a.value - b.value;
          if (need <= 0) continue;
          for (const f of finishes) {
            if (f.value === need) results.push([a, b, f]);
          }
        }
      }

      // Sort: fewer darts first, then higher first dart, then higher second dart
      results.sort((x, y) => {
        if (x.length !== y.length) return x.length - y.length;
        const xv0 = x[0]?.value ?? 0, yv0 = y[0]?.value ?? 0;
        if (yv0 !== xv0) return yv0 - xv0;
        const xv1 = x[1]?.value ?? 0, yv1 = y[1]?.value ?? 0;
        return yv1 - xv1;
      });

      // De-dupe by string
      const seen = new Set();
      const formatted = [];
      for (const line of results) {
        const text = line.map(d => d.label).join(' ');
        if (!seen.has(text)) {
          seen.add(text);
          formatted.push(text);
        }
        if (formatted.length >= maxOptions) break;
      }

      return formatted;
    }

function renderCheckoutPanel() {
  if (!playerScores.length) return;

  const p = playerScores[currentPlayerIndex];
  const options = getCheckoutOptions(p.score, 6); // change 6 to how many you want

  if (!options.length) {
    checkoutPanel.classList.add('hidden');
    checkoutOptions.innerHTML = '';
    return;
  }

  checkoutPanel.classList.remove('hidden');

  checkoutOptions.innerHTML = `
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
      <div class="text-sm font-semibold">
        ${p.name} <span class="text-white/70 font-medium">(${p.score})</span>
      </div>
      <div class="flex flex-wrap gap-2">
        ${options.map(opt => `
          <span class="px-3 py-1 rounded-full bg-white/10 border border-white/15 text-sm font-semibold tracking-wide">
            ${opt}
          </span>
        `).join('')}
      </div>
    </div>
  `;
}

    // Game Logic
    function startGame() {
      sets = parseInt(document.getElementById('sets-select').value);
      legs = parseInt(document.getElementById('legs-select').value);

      players = Array.from(document.querySelectorAll('.player-input')).map((input, i) => ({
        id: i,
        name: input.value || `Player ${i + 1}`
      }));

      resetGame();
      setupScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');
      winnerScreen.classList.add('hidden');
    }

    function resetGame() {
      playerScores = players.map(p => ({
        ...p,
        score: gameType,
        setsWon: 0,
        legsWon: 0,
        history: []
      }));

      currentPlayerIndex = 0;
      inputValue = '';
      updateScoreDisplay();
      renderScoreCards();
      updateGameInfo();
      winnerScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');
    }

    function showSetup() {
      setupScreen.classList.remove('hidden');
      gameScreen.classList.add('hidden');
      winnerScreen.classList.add('hidden');
    }

    // Score cards now show attempts + 3-dart avg
    function renderScoreCards() {
      const container = document.getElementById('score-cards');

      container.innerHTML = playerScores.map((player, idx) => {
        const avg = getThreeDartAverage(player).toFixed(1);
        const attempts = formatAttempts(player, 8);

        return `
          <div class="bg-white rounded-2xl p-4 md:p-6 shadow-xl transition-all ${idx === currentPlayerIndex ? 'ring-4 ring-dart-bordeaux animate-pulse-glow' : 'opacity-70'}">
            <div class="space-y-3">
              <div class="text-center">
                <p class="text-gray-500 text-sm font-medium truncate">${player.name}</p>
                <p class="text-xs text-gray-400">3-dart avg: <span class="text-gray-700 font-semibold">${avg}</span></p>
              </div>

              <div class="text-center">
                <p class="text-5xl md:text-7xl font-bold text-gray-800">${player.score}</p>
              </div>

              <div class="flex justify-center gap-4 text-sm">
                <span class="text-gray-500">Sets: <span class="text-gray-800 font-semibold">${player.setsWon}</span></span>
                <span class="text-gray-500">Legs: <span class="text-gray-800 font-semibold">${player.legsWon}</span></span>
              </div>

              <div class="bg-gray-50 rounded-xl p-3">
                <p class="text-xs text-gray-500">
                  Attempts: <span class="text-gray-700 font-semibold">${attempts}</span>
                </p>
              </div>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('current-turn').textContent = `${playerScores[currentPlayerIndex].name}'s turn`;

      // NEW: update checkout panel whenever cards render
      renderCheckoutPanel();
    }

    function updateGameInfo() {
      const setsToWin = Math.ceil(sets / 2);
      const legsToWin = Math.ceil(legs / 2);
      document.getElementById('game-info').textContent = `First to ${setsToWin} sets (${legsToWin} legs per set)`;
    }

    function submitScore() {
      const score = parseInt(inputValue) || 0;

      if (score > 180) {
        showToast('Invalid score - Max is 180');
        return;
      }

      const currentPlayer = playerScores[currentPlayerIndex];
      const newScore = currentPlayer.score - score;

      if (newScore < 0 || newScore === 1) {
        showToast('Bust! Turn passes');
        inputValue = '';
        updateScoreDisplay();
        nextPlayer();
        return;
      }

      currentPlayer.score = newScore;
      currentPlayer.history.push(score);

      if (newScore === 0) {
        handleLegWin();
      } else {
        nextPlayer();
      }

      inputValue = '';
      updateScoreDisplay();
    }

    function nextPlayer() {
      currentPlayerIndex = (currentPlayerIndex + 1) % playerScores.length;
      renderScoreCards();
    }

    function handleLegWin() {
      const winner = playerScores[currentPlayerIndex];
      winner.legsWon++;

      const legsToWin = Math.ceil(legs / 2);
      showToast(`${winner.name} wins the leg! (${winner.legsWon}/${legsToWin})`);

      if (winner.legsWon >= legsToWin) {
        handleSetWin();
      } else {
        resetLeg();
      }
    }

    function handleSetWin() {
      const winner = playerScores[currentPlayerIndex];
      winner.setsWon++;

      const setsToWin = Math.ceil(sets / 2);
      showToast(`${winner.name} wins the set! (${winner.setsWon}/${setsToWin})`);

      if (winner.setsWon >= setsToWin) {
        showWinner(winner);
      } else {
        resetSet();
      }
    }

    function resetLeg() {
      playerScores.forEach(p => {
        p.score = gameType;
        p.history = [];
      });
      renderScoreCards();
    }

    function resetSet() {
      playerScores.forEach(p => {
        p.score = gameType;
        p.legsWon = 0;
        p.history = [];
      });
      renderScoreCards();
    }

    function showWinner(winner) {
      gameScreen.classList.add('hidden');
      winnerScreen.classList.remove('hidden');
      document.getElementById('winner-name').textContent = `${winner.name} Wins!`;
      document.getElementById('winner-score').textContent = `Final Score: ${winner.setsWon} sets`;
    }

    function showToast(message) {
      toast.textContent = message;
      toast.classList.remove('translate-y-20', 'opacity-0');
      setTimeout(() => {
        toast.classList.add('translate-y-20', 'opacity-0');
      }, 2500);
    }
  </script>
</body>
</html>
